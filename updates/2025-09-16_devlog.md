# September 16, 2025 Devlog

## Today's Goals
- Review project architecture
- Check CSS design system files
- Begin work on AI assistant development

## Vercel AI SDK Message Format Investigation - Fix Attempt
**Date**: September 16, 2025 - 12:15 PM - Implementation Session  
**Status**: ⚠️ Implemented but TypeScript errors remain

Investigated digest claims about Vercel AI SDK message format issues in `convex/ai/simpleMessages.ts`. The digest was largely accurate about the problems but had incorrect fix suggestions.

**Analysis Results:**
- ✅ Confirmed `tool_call_parts` property doesn't exist on AssistantModelMessage
- ✅ Confirmed tool result output format was incorrect (raw strings vs structured content)
- ❌ Digest suggested `toolInvocations` property which is UIMessage-specific, not ModelMessage

**Implementation Approach:**
Made the call to adopt the OpenCode pattern using `convertToModelMessages` utility from Vercel AI SDK rather than manual ModelMessage construction. This approach is more robust and aligns with documented best practices.

**Changes Made:**
- Updated import to include `convertToModelMessages` and `UIMessage` types `simpleMessages.ts:1`
- Completely rewrote `convertConvexToModelMessages` function to use two-step process:
  1. Convert Convex messages to UIMessage format 
  2. Use AI SDK's `convertToModelMessages` for final transformation
- Fixed tool result output to use structured format: `[{ type: "text", text: output }]`

**Current Status:**
Implementation complete but TypeScript compilation still failing with 3 errors:
1. `toolName` property doesn't exist on tool call parts in UIMessage
2. `"tool"` role not assignable to UIMessage (expects user/assistant/system only)  
3. `toolName` property doesn't exist on tool result parts

**Engineering Decision:**
The UIMessage interface from Vercel AI SDK appears to have different constraints than expected. The digest's analysis was correct about the problems but the UI-first approach may not be the right solution. May need to revert to direct ModelMessage construction with proper property names.

**Lessons Learned:**
- Vercel AI SDK documentation shows examples but TypeScript interfaces are more restrictive
- `convertToModelMessages` utility expects specific UIMessage structure that doesn't match our needs
- Manual ModelMessage construction might be necessary for our Convex integration pattern

**Next Steps:**
- Need to either fix UIMessage structure or revert to corrected manual ModelMessage approach
- The core fixes (proper content structure, correct output format) are solid principles regardless of approach