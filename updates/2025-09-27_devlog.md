# 2025-09-27 Development Log

## Session Start
- **Date**: September 27, 2025
- **Time**: 6:48 PM
- **Status**: Starting startup routine

## Tasks Completed

### Major Prompt Improvements
1. **Fixed Planning Mode Conflicting Prompts**
   - **Problem**: Planning mode had conflicting instructions - `planning_new.ts` demanded "UNDER 150 CHARACTERS" but `registry.ts` asked for "systematic plans with clear next steps"
   - **Root Cause**: LLM was receiving both prompts and prioritizing the later, more verbose instruction
   - **Fix**: Updated registry.ts planning mode promptInjection to enforce brevity while keeping conversational tone
   - **Files Modified**: `convex/ai/modes/registry.ts`, `convex/ai/prompts/planning_new.ts`

2. **Information Collector Complete Rewrite**
   - **Problem**: Robotic, formal language using "QUESTION_FOR_USER:" markers and awkward phrasing
   - **Fix**: Completely rewrote to natural conversation style
   - **Reduced from**: 161 lines to 79 lines (well under 100-line requirement)
   - **Language Changes**:
     - Removed: "What's your deadline for...", "Do you have a deadline in mind?"
     - Added: "When does this need to be done?", "How much effort would that take?"
   - **Data Collection**: Reduced from 3 points (deadline, effort, dependencies) to 2 points (timing, effort only)
   - **File Modified**: `convex/ai/prompts/information_collector_new.ts`

3. **Removed Forced/Artificial Language**
   - **Eliminated**: "Let's start with...", "To prioritize...", "Sounds overwhelming!"
   - **Added explicit rules**: Clear "NEVER USE" list for LLM to follow
   - **Result**: More natural, direct questions without meta-commentary

## Technical Issues Encountered

### Grok-4-Fast Rate Limiting Error
- **Time**: 19:30:54
- **Error**: `AI_RetryError` - "Provider returned error" (Status 429)
- **Root Cause**: `x-ai/grok-4-fast is temporarily rate-limited upstream`
- **Details**: Failed after 4 retry attempts through OpenRouter
- **Impact**: User request "I've got a bunch of stuff swirling around in my head..." failed to process
- **Error Response**: "No output generated. Check the stream for errors."
- **Note**: This is an upstream provider issue, not a code problem

## Files Modified
- `convex/ai/modes/registry.ts` - Fixed planning mode promptInjection
- `convex/ai/prompts/planning_new.ts` - Updated for conversational brevity  
- `convex/ai/prompts/information_collector_new.ts` - Complete rewrite (161â†’79 lines)

## Key Insights
- **Conflicting prompts** cause verbose output even when one prompt demands brevity
- **Mode registry promptInjection** takes precedence over main prompt files
- **Natural language examples** work better than formal business terminology
- **Line count reduction** forces essential-only content, improving clarity

## Next Steps
- Monitor if Grok-4-Fast rate limiting persists
- Test new prompt improvements in production
- Consider fallback models for rate-limited scenarios