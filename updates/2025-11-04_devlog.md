## GCAL Connect UX Hardening & Status API (09:40)

**Status**: ✅ Deterministic status check added; flicker removed; delete flow hardened

### Context
Users reported the Settings “Connect” button flashing “Connecting…” on load and, after deleting an account and creating a new one, seeing “Disconnect” without an explicit consent flow. Logs showed repeated `testGoogleCalendarConnection` calls and 422s (“Unprocessable Entity”) for token fetch.

### Changes Made
- Backend: Single-source status API
  - Added `convex/googleCalendar/auth.ts:getConnectionStatus` — returns `connected`, `reason` (`no_external_account | no_token | missing_scopes`), `hasExternalAccount`, `approvedScopes`, `providerAttempts`, and `legacyRefreshTokenPresent`.
  - Emits `[GCAL][STATUS_API] start/done` with `runId` and per-provider token fetch diagnostics.

- Frontend: Settings UX stabilization
  - `src/views/SettingsView.tsx:Checking` vs `Connecting` split — page-load probe now shows “Checking…” (disabled), not “Connecting…”.
  - De-duped concurrent status checks with an in-flight guard; removed window focus auto-check in production.
  - Button shows “Connecting…” only after a user click; state set solely by `getConnectionStatus()`.
  - Added `[GCAL][STATUS] start/done` logs with `runId` and `reason`.

- Account deletion safety
  - `convex/account.ts:deleteMyAccount` — proactively calls `googleCalendar.auth.forceDestroyGoogleExternalAccount` and `revokeLegacyGoogleToken` before deleting Convex data and the Clerk user.

### Result
- No flicker on Settings load; deterministic status rendering.
- Status no longer inferred from UI heuristics; tied to server-verified scopes/tokens.
- Delete account performs a hard disconnect before removal.

### Notes / Next Steps
- Current status API considers `approvedScopes` when token scopes are unavailable; this can still display “Connected” if Clerk auto-links an external account with remembered scopes but no valid access token. Planned refinement: require token-derived scopes for `connected = true` (ignore `approvedScopes` alone), or disable Clerk auto-linking-by-email in production.
- Add an optional “Debug details” drawer in Settings showing the last `getConnectionStatus()` payload to speed up on-call diagnosis.

